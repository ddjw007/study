# 文件描述符
- 在Linux下用文件描述符来表示设备文件和普通文件。
- 文件描述符是文件系统中连接用户空间和内核空间的枢纽。

其工作逻辑是：
- 当打开或创建一个文件时，内核空间创建相应的结构，并生成一个整型的变量传递给用户空间的对应进程。
- 进程用这个文件描述符来对文件进行操作。用户空间的文件操作，例如读或写一个文件时，将文件描述符作为参数传送给`read`和`write`。
- 读写函数的系统调用到达内核时，内核解析作为文件描述符的整型变量，找到相应设备文件运行的相应的函数，并返回用户空间结果。

- 文件描述符的值仅在同一个进程中有效。

- 在Linux系统中有3个已经分配的文件描述符，标准输入(0)、标准输出(1)、标准错误(2)。



## 文件空间映射`mmap()`函数
`mmap()`函数用来将文件或设备空间映射到内存中，可以通过对映射后的内存空间存取来获得与存取文件一致的控制方式，这种方式下，内存比磁盘快一些，映射到内存并不占用空间，仅仅占用一段地址空间。其声明为：
```C++
#include <sys/mman.h>
void *mmap(void *start, size_t length, int prot, int flags, int fd, off_t offset);
```

## 取消映射关系`munmap()`函数
取消`mmap()`函数的映射关系，声明：
```C++
#include <sys/mman.h>
int munmap(void *start, size_t length);
```

## 文件属性`fcntl()`函数
`fcntl()`函数用于获得和改变已经打开文件的性质。
声明为：
```C++
#include <unistd.h>
#include <fcntl.h>
int fcntl(int fd, int cmd);
int fcntl(int fd, int cmd, long arg);
int fcntl(int fd, int cmd, struct flock *lock);
```


## 文件输入输出控制`ioctl()`函数

`ioctl`是`input output control`的简写，表示输入输出控制，`ioctl()`函数通过对文件描述符的发送命令来控制设备。

```C++
#include <sys/ioctl.h>
int ioctl(int d, int request, ...);
```

使用`ioctl()`像其他的系统调用一样：打开文件，发送命令，查询结果。




